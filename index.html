<!DOCTYPE html>
<html>
<head>
  <title>Test UMD Package</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <script src="dist/index.umd.js"></script>
  <!-- <script src="https://unpkg.com/pockit-os@latest/dist/index.umd.js"></script> -->
  <script>
    // Example: Load a window from a DOM string at startup
    new PockitOS(document.body, {
      onStateChange: function(state) {
        // console.log('PockitOS state changed:', state);
      }
      // , state: '<div style="left:50%;top:50%;z-index:1000;position:absolute;">adsadasd</div>'
    });
    
    // Register a plugin that shows the app's content as plaintext in a modal with a Reverse Button
    const reverseModalPlugin = function(app) {
      let modal;
      function renderModalContent() {
        const content = app.getContent();
        return `
          <pre id="pockit-modal-pre" style="white-space:pre-wrap;word-break:break-all;">${content
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')}</pre>
          <button id="pockit-reverse-btn" style="margin-top:12px;padding:4px 12px;background:#eee;border:1px solid #bbb;cursor:pointer;">Reverse</button>
        `;
      }
      modal = new Modal({
        content: renderModalContent(),
        onClose: () => {}
      });
      setTimeout(() => {
        const reverseBtn = document.getElementById('pockit-reverse-btn');
        if (reverseBtn) {
          reverseBtn.onclick = () => {
            const reversed = app.getContent().split('').reverse().join('');
            app.setContent(reversed);
            // Update modal content as well
            const pre = document.getElementById('pockit-modal-pre');
            if (pre) pre.innerHTML = reversed.replace(/</g, '&lt;').replace(/>/g, '&gt;');
          };
        }
      }, 0);
    };
    PockitOS.loadPlugin(reverseModalPlugin, 'â‡„');

    // Register a plugin that opens a modal with a text input, sends input to an AI API, and sets content to the result
    const aiModalPlugin = function(app) {
      let modal;
      function renderModalContent() {
        return `
          <input id="pockit-ai-input" type="text" placeholder="Ask AI..." style="width:90%;padding:6px;margin-bottom:8px;border:1px solid #bbb;" />
          <button id="pockit-ai-submit" style="padding:4px 12px;background:#eee;border:1px solid #bbb;cursor:pointer;">Ask</button>
          <div id="pockit-ai-result" style="margin-top:12px;white-space:pre-wrap;"></div>
        `;
      }
      modal = new Modal({
        content: renderModalContent(),
        onClose: () => {}
      });
      setTimeout(() => {
        const input = document.getElementById('pockit-ai-input');
        const submit = document.getElementById('pockit-ai-submit');
        const resultDiv = document.getElementById('pockit-ai-result');
        if (submit && input) {
          submit.onclick = async () => {
            const prompt = input.value;
            resultDiv.textContent = 'Thinking...';
            try {
              // Replace the URL below with your actual AI API endpoint
              const response = await fetch('https://api.example.com/ai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt })
              });
              const data = await response.json();
              const aiText = data.result || data.text || 'No response';
              app.setContent(aiText);
              resultDiv.textContent = aiText;
            } catch (e) {
              resultDiv.textContent = 'Error contacting AI.';
            }
          };
        }
      }, 0);
    };
    PockitOS.loadPlugin(aiModalPlugin, 'ðŸ¤–');
  </script>
</body>
</html>