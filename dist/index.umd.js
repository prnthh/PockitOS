(function(p,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(p=typeof globalThis<"u"?globalThis:p||self,p.PockitOS=h())})(this,function(){"use strict";var T=Object.defineProperty;var z=(p,h,y)=>h in p?T(p,h,{enumerable:!0,configurable:!0,writable:!0,value:y}):p[h]=y;var g=(p,h,y)=>z(p,typeof h!="symbol"?h+"":h,y);class p{constructor(e=document.body){this.container=e,this.menubar=document.createElement("div"),this.menubar.className="pockit-menubar flex items-center bg-gray-900 text-white px-2 py-1",this.menubar.style.position="fixed",this.menubar.style.top="0",this.menubar.style.left="0",this.menubar.style.right="0",this.menubar.style.width="100%",this.menubar.style.zIndex=1e5,this.menubar.style.height="32px",this.menubar.style.userSelect="none",this.container.appendChild(this.menubar),this.menus=[],p.instances||(p.instances=[]),p.instances.push(this)}addMenu(e,t){const i=document.createElement("div");i.className="relative group mr-4",i.style.display="inline-block";const n=document.createElement("button");n.className="px-3 py-1 hover:bg-gray-700 rounded",n.textContent=e,i.appendChild(n);const o=document.createElement("div");o.className="absolute left-0 mt-1 bg-white text-black border border-gray-300 shadow-lg rounded hidden group-hover:block",o.style.minWidth="160px",o.style.zIndex=100001,t.forEach(r=>{const a=document.createElement("div");a.className="px-4 py-2 hover:bg-gray-200 cursor-pointer",a.textContent=r.label,a.onclick=u=>{u.stopPropagation(),o.style.display="none",r.onClick()},o.appendChild(a)}),n.onclick=r=>{r.stopPropagation(),document.querySelectorAll(".pockit-menubar .dropdown-open").forEach(a=>{a.classList.remove("dropdown-open"),a.style.display="none"}),o.style.display=o.style.display==="block"?"none":"block",o.style.display==="block"&&o.classList.add("dropdown-open")},document.addEventListener("click",()=>{o.style.display="none",o.classList.remove("dropdown-open")}),i.appendChild(o),this.menubar.appendChild(i),this.menus.push({label:e,options:t})}}typeof window<"u"&&(window.PockitMenubar=p);class h{constructor(e,t=null){this.container=e,this.state=t,this.id=t&&t.id?t.id:"pockit-"+Math.random().toString(36).slice(2,10),this.setup()}setup(){this.element=this.createUI(this.state),this.container.appendChild(this.element),this.state?this.setPosition(this.state):this.centerInContainer(),this.makeDraggable(),this.element.id=this.id,this.element.classList.add("bg-white/60","backdrop-blur"),this.q("textarea").addEventListener("input",()=>{var e;return(e=this.onContentChange)==null?void 0:e.call(this)}),window.PockitOS&&Array.isArray(window.PockitOS._plugins)&&this.addPluginButtons(),this.isRendered=!1,this.setViewMode(!1)}addPluginButtons(){if(!window.PockitOS||!Array.isArray(window.PockitOS._plugins))return;const e=this.element.querySelector(".buttons");e&&window.PockitOS._plugins.forEach((t,i)=>{if(e.querySelector(`.btn-plugin[data-plugin-idx="${i}"]`))return;const n=document.createElement("button");n.className="btn-plugin w-6 h-6 flex items-center justify-center bg-yellow-400 hover:bg-yellow-500 transition mr-1",n.style.borderRadius="0",n.setAttribute("data-plugin-idx",i),n.innerHTML=t.icon||"‚òÖ",n.onclick=()=>t.handler(this),e.insertBefore(n,e.firstChild)})}createUI(e=null){const t=document.createElement("div");t.className="pockit-os-window fixed min-w-[300px] min-h-[150px]",t.style.cssText="z-index:1000;position:absolute;border:none;";const i=this.id;let n="";if(window.PockitOS&&window.PockitOS._plugin&&(n='<button class="btn-plugin w-6 h-6 flex items-center justify-center bg-yellow-400 hover:bg-yellow-500 transition mr-1" style="border-radius:0;">‚òÖ</button>'),t.innerHTML=`
      <div class="title-bar flex items-center justify-between px-3 py-2 bg-gray-800 cursor-move select-none" style="border-radius:0;padding:0;opacity:1;">
        <span class='text-xs text-gray-300 ml-2 pockit-id-span'>[${i}]</span>
        <div class="buttons flex">
          ${n}
          <button class="btn-add w-6 h-6 flex items-center justify-center bg-green-500 hover:bg-green-600 transition" style="border-radius:0;">üëØ‚Äç‚ôÄÔ∏è</button>
          <button class="btn-eye w-6 h-6 flex items-center justify-center bg-blue-500 hover:bg-blue-600 transition" style="border-radius:0;">‚úèÔ∏è</button>
          <button class="btn-close w-6 h-6 flex items-center justify-center bg-red-500 hover:bg-red-600 transition" style="border-radius:0;">üóëÔ∏è</button>
        </div>
      </div>
      <div class="content text-gray-800" style="padding:0;">
        <textarea class="w-full h-32 border border-gray-300 mb-0" style="resize: both;" placeholder="Type here...">${(e==null?void 0:e.value)||""}</textarea>
        <div class="rendered-content w-full min-h-32 p-[1px]" style="display:none;white-space:pre-wrap;"></div>
      </div>
    `,this.attachIdEditHandler(t.querySelector(".pockit-id-span")),t.querySelector(".btn-close").onclick=()=>{var o;t.remove(),(o=this.onClose)==null||o.call(this)},t.querySelector(".btn-add").onclick=()=>{var l;const o=this.getState(),r=(parseInt(o.left,10)||0)+30,a=(parseInt(o.top,10)||0)-30,u={...o,left:r+"px",top:a+"px",id:void 0};(l=this.onDuplicate)==null||l.call(this,u)},t.querySelector(".btn-eye").onclick=()=>{this.setViewMode(!this.isRendered)},t.querySelector("textarea").addEventListener("input",()=>{this.isRendered&&this.setViewMode(!0)}),window.PockitOS&&window.PockitOS._plugin){const o=t.querySelector(".btn-plugin");o&&(o.onclick=()=>window.PockitOS._plugin(this))}return t}attachIdEditHandler(e){e.ondblclick=()=>{const t=document.createElement("input");t.type="text",t.value=this.id,t.className="text-xs text-gray-800 ml-2 pockit-id-input",t.style.cssText=`width:${Math.max(60,this.id.length*8)}px;color:#fff;background:transparent;`,e.replaceWith(t),t.focus(),t.select();const i=()=>{this.setId(t.value.trim());const n=document.createElement("span");n.className="text-xs text-gray-300 ml-2 pockit-id-span",n.textContent=`[${this.id}]`,this.attachIdEditHandler(n),t.replaceWith(n)};t.addEventListener("blur",i),t.addEventListener("keydown",n=>n.key==="Enter"&&t.blur())}}centerInContainer(){Object.assign(this.element.style,{left:"50%",top:"50%",transform:"translate(-50%, -50%)"})}setPosition(e){Object.assign(this.element.style,{left:e.left||"50%",top:e.top||"50%",transform:""}),e.zIndex&&(this.element.style.zIndex=e.zIndex)}makeDraggable(){const e=this.element,t=e.querySelector(".title-bar");let i=0,n=0,o=!1;const r=(l,d)=>{var c;if(e.style.transform&&e.style.transform.includes("translate")){const m=e.offsetParent.getBoundingClientRect(),f=e.getBoundingClientRect();e.style.left=f.left-m.left+"px",e.style.top=f.top-m.top+"px",e.style.transform=""}i=l-e.offsetLeft,n=d-e.offsetTop,o=!0,(c=this.onFocus)==null||c.call(this)},a=(l,d)=>{var c;o&&(e.style.left=l-i+"px",e.style.top=d-n+"px",(c=this.onMove)==null||c.call(this))},u=()=>{o=!1};t.addEventListener("mousedown",l=>{r(l.pageX,l.pageY);const d=m=>a(m.pageX,m.pageY),c=()=>{u(),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",d),document.addEventListener("mouseup",c)}),t.addEventListener("touchstart",l=>{if(l.touches.length!==1)return;const d=l.touches[0];r(d.pageX,d.pageY);const c=f=>{f.touches.length===1&&a(f.touches[0].pageX,f.touches[0].pageY)},m=()=>{u(),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",m)};document.addEventListener("touchmove",c),document.addEventListener("touchend",m)})}q(e){return this.element.querySelector(e)}getContent(){var e;return((e=this.q("textarea"))==null?void 0:e.value)||""}setContent(e){this.q("textarea")&&(this.q("textarea").value=e)}getState(){return{left:this.element.style.left,top:this.element.style.top,zIndex:this.element.style.zIndex,value:this.getContent(),id:this.id}}setZIndex(e){this.element.style.zIndex=e}setId(e){var i;if(!e)return;this.id=e,this.element.id=this.id;const t=this.q(".pockit-id-span");t&&(t.textContent=`[${this.id}]`),(i=this.onContentChange)==null||i.call(this)}setViewMode(e){var a;const t=this.q(".btn-eye"),i=this.q("textarea"),n=this.q(".rendered-content"),o=this.q(".title-bar");if(!t)return;const r=this.element;if((a=this._injectedModuleScripts)==null||a.forEach(u=>u.remove()),this._injectedModuleScripts=[],e){n.innerHTML="";const u=document.createElement("div");for(u.innerHTML=i.value,u.querySelectorAll("script").forEach(l=>{const d=document.createElement("script");for(const c of l.attributes)d.setAttribute(c.name,c.value);d.textContent=l.textContent,l.type==="importmap"?document.querySelector('script[type="importmap"][data-pockit]')||(d.setAttribute("data-pockit","true"),document.head.appendChild(d),(this._injectedModuleScripts||(this._injectedModuleScripts=[])).push(d)):(document.body.appendChild(d),(this._injectedModuleScripts||(this._injectedModuleScripts=[])).push(d)),l.remove()});u.firstChild;)n.appendChild(u.firstChild);i.style.display="none",n.style.display="",o&&(o.style.opacity="0.5",o.classList.add("opacity-50")),r.classList.remove("bg-white/60","backdrop-blur"),r.classList.remove("opacity-50"),t.innerHTML="‚úèÔ∏è"}else i.style.display="",n.style.display="none",o&&(o.style.opacity="1",o.classList.remove("opacity-50")),r.classList.remove("opacity-50"),r.classList.add("bg-white/60","backdrop-blur"),t.innerHTML="‚ñ∂Ô∏è";this.element.style.border="none",this.isRendered=e}}class y{constructor({content:e="",onClose:t=null}={}){this.content=e,this.onClose=typeof t=="function"?t:null,this.element=this.createModal(),document.body.appendChild(this.element)}createModal(){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background="rgba(0,0,0,0.3)",e.style.zIndex=1e6,e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center";const t=document.createElement("div");t.className="pockit-modal bg-white rounded shadow-lg p-6 max-w-md w-full relative",t.style.position="relative",t.style.boxShadow="0 4px 32px rgba(0,0,0,0.18)";const i=document.createElement("button");i.textContent="√ó",i.setAttribute("aria-label","Close"),i.style.position="absolute",i.style.top="12px",i.style.right="16px",i.style.fontSize="1.5rem",i.style.background="none",i.style.border="none",i.style.cursor="pointer",i.onclick=()=>this.close();const n=document.createElement("div");return typeof this.content=="string"?n.innerHTML=this.content:this.content instanceof Node&&n.appendChild(this.content),t.appendChild(i),t.appendChild(n),e.appendChild(t),e.onclick=o=>{o.target===e&&this.close()},e}close(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.onClose&&this.onClose()}}function P(){return`
    <div style="font-size:12px;font-weight:bold;margin-bottom:4px;">PockitOS Memory</div>
    <textarea id="pockit-debug-textarea" style="width:100%;height:180px;font-size:11px;font-family:monospace;" class="mb-0"></textarea>
    <div style="margin-top:4px;">
      <button id="pockit-restoreall-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#f3f3f3;cursor:pointer;">Load</button>
      <button id="pockit-save-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#e3f3e3;cursor:pointer;margin-left:8px;">Save</button>
      <button id="pockit-viewraw-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#e3e3f3;cursor:pointer;margin-left:8px;">View Raw</button>
    </div>
  `}class L{constructor(e){this.PockitOS=e}show(){const e=new y({content:P(),onClose:()=>{}});setTimeout(()=>{const t=document.getElementById("pockit-debug-textarea");t.style.display="none",t.value=this.PockitOS.memory.map(r=>`<div style="left:${r.left};top:${r.top};z-index:${r.zIndex};position:absolute;" id="${r.id||""}">${r.value}</div>`).join(`

`);let i=document.getElementById("pockit-load-file-input");i||(i=document.createElement("input"),i.type="file",i.accept=".html,text/html",i.style.display="none",i.id="pockit-load-file-input",document.body.appendChild(i)),document.getElementById("pockit-restoreall-btn").onclick=()=>{i.value="",i.click()},i.onchange=r=>{const a=r.target.files[0];if(!a)return;const u=new FileReader;u.onload=l=>{const d=l.target.result,c=/<body[^>]*>([\s\S]*?)<\/body>/i.exec(d);c&&c[1]&&(t.value=c[1].trim(),t.dispatchEvent(new Event("input",{bubbles:!0})),e.close())},u.readAsText(a)},document.getElementById("pockit-save-btn").onclick=()=>{const a=`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PockitOS Memory Dump</title>
  <style>body{background:#fafafa;margin:24px;}div{margin-bottom:8px;}</style>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"><\/script>
</head>
<body>
${t.value}
</body>
</html>`,u=new Blob([a],{type:"text/html"}),l=document.createElement("a");l.href=URL.createObjectURL(u),l.download="pockitos-memory.html",document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),URL.revokeObjectURL(l.href)},100)};const n=document.getElementById("pockit-viewraw-btn");let o=!1;n.textContent="View Raw",n.onclick=()=>{o=!o,t.style.display=o?"":"none",n.textContent=o?"Hide Raw":"View Raw"},t.addEventListener("input",()=>{this.PockitOS.restoreAll(void 0,t.value)})},0)}}function I(){const w="pockit-tailwind-cdn";if(!document.getElementById(w)){const e=document.createElement("script");e.id=w,e.src="https://cdn.tailwindcss.com",document.head.appendChild(e)}}const s=class s{static loadMenubarPlugin(e){s._menubarPlugins||(s._menubarPlugins=[]),s._menubarPlugins.push(e),window.PockitOS&&window.PockitOS._instances&&window.PockitOS._instances.forEach(t=>{var n,o;if(document.querySelector(".pockit-menubar")&&t){const r=((o=(n=window.PockitMenubar)==null?void 0:n.instances)==null?void 0:o[0])||null;if(r)try{e(r,t)}catch{}}})}static setKioskMode(e){s.kioskMode=e;const t=document.querySelector(".pockit-menubar");t&&(t.style.display=e?"none":"");const i=document.getElementById("pockit-debug-window");i&&(i.style.display=e?"none":""),document.querySelectorAll(".pockit-os-window .title-bar").forEach(n=>{n.style.display=e?"none":""}),window.PockitOS&&window.PockitOS._instances&&window.PockitOS._instances.forEach(n=>{n.apps&&n.apps.forEach(o=>{e&&(o.setViewMode(!1),o.setViewMode(!0))})})}constructor(e=document.body,t={}){this.container=e,this.apps=[],this.onStateChange=typeof t.onStateChange=="function"?t.onStateChange:null,I(),typeof window<"u"&&(window.PockitOS._instances||(window.PockitOS._instances=[]),window.PockitOS._instances.push(this)),this.saveMenu=new L(s);let i=!1;if(typeof t.state=="string"&&t.state.trim().startsWith("<div")?(i=!0,this._restoringFromDOM=!0,s.restoreAll(e,t.state,this)):Array.isArray(t.state)&&t.state.length>0?(s.memory=t.state,t.state.forEach(o=>this.createApp(o))):t.state?this.createApp(t.state):i||this.createApp(),!document.querySelector(".pockit-menubar")){const o=new p(document.body);o.addMenu("OS",[{label:"New Window",onClick:()=>{this.createApp()}},{label:"Save/Load",onClick:()=>{this.saveMenu.show()}},{label:"Kiosk Mode",onClick:()=>{s.setKioskMode(!s.kioskMode)}},{label:"About",onClick:()=>{new y({content:`<div class='text-center'><h2 class='text-lg font-bold mb-2'>About PockitOS</h2><p class='mb-2'><a target="_blank" href="https://github.com/prnthh/PockitOS">PockitOS</a> is a lightweight, modular web OS for running and managing Pockit apps in your browser.</p><p class='text-xs text-gray-500'>¬© 2025 prnth</p></div>`})}}]),s._menubarPlugins&&Array.isArray(s._menubarPlugins)&&s._menubarPlugins.forEach(r=>{try{r(o,this)}catch{}})}const n=document.getElementById("pockit-debug-window");n&&n.remove(),s.kioskMode&&s.setKioskMode(!0)}createApp(e=null){const t=new h(this.container,e);return t.onClose=()=>{const i=this.apps.indexOf(t);i!==-1&&this.apps.splice(i,1),s.updateMemory(this.onStateChange)},t.onAdd=()=>{this.createApp()},t.onContentChange=()=>{s.updateMemory(this.onStateChange)},t.onFocus=()=>{t.setZIndex(s.zIndexCounter++),s.updateMemory(this.onStateChange)},t.onMove=()=>{s.updateMemory(this.onStateChange)},t.onDuplicate=i=>{this.createApp(i)},t.setZIndex(s.zIndexCounter++),this.apps.push(t),t}static updateMemory(e=null){const t=[];document.querySelectorAll(".pockit-os-window").forEach(n=>{const o=n.querySelector("textarea");t.push({left:n.style.left,top:n.style.top,zIndex:n.style.zIndex,value:o?o.value:"",id:n.id})}),s.memory=t;const i=s.memory.map(n=>`<div style="left:${n.left};top:${n.top};z-index:${n.zIndex};position:absolute;" id="${n.id}">${n.value}</div>`).join(`

`);typeof e=="function"&&e(i)}static restoreAll(e=document.body,t=null,i=null){document.querySelectorAll(".pockit-os-window").forEach(r=>r.remove());let n=t;if(!n){const r=document.getElementById("pockit-debug-textarea");r&&(n=r.value.trim())}if(n&&n.startsWith("<div")){const r=[];new DOMParser().parseFromString(`<root>${n}</root>`,"text/html").body.querySelectorAll("root > div").forEach(d=>{var v,k,E,S,C,M;const c=d.getAttribute("style")||"",m=((k=(v=/left:([^;]+);/.exec(c))==null?void 0:v[1])==null?void 0:k.trim())||"",f=((S=(E=/top:([^;]+);/.exec(c))==null?void 0:E[1])==null?void 0:S.trim())||"",A=((M=(C=/z-index:([^;]+);/.exec(c))==null?void 0:C[1])==null?void 0:M.trim())||"",O=d.getAttribute("id")||"";let q=Array.from(d.childNodes).map(b=>b.nodeType===Node.ELEMENT_NODE&&b.nodeName==="DIV"?b.outerHTML:b.nodeType===Node.TEXT_NODE?b.textContent:b.nodeType===Node.ELEMENT_NODE?b.outerHTML:"").join("");r.push({left:m,top:f,zIndex:A,value:q,id:O})}),r.length>0&&(s.memory=r)}const o=i||new s(e);o.apps.length>0&&(o.apps[0].element.remove(),o.apps=[]),s.memory.forEach(r=>{const a=o.createApp(r);typeof a.setViewMode=="function"&&a.setViewMode(!0)}),typeof showDebugWindow=="function"&&showDebugWindow(),typeof updateDebugWindow=="function"&&updateDebugWindow()}static loadPlugin(e,t="‚òÖ"){s._plugins||(s._plugins=[]),s._plugins.push({handler:e,icon:t}),window.PockitOS&&window.PockitOS._instances&&window.PockitOS._instances.forEach(i=>{i.apps&&i.apps.forEach(n=>n.addPluginButtons())})}static registerMenubarPlugin(e){s._menubarPlugins||(s._menubarPlugins=[]),s._menubarPlugins.push(e)}};g(s,"zIndexCounter",1e3),g(s,"memory",[]),g(s,"kioskMode",!1),g(s,"_plugin",null),g(s,"_plugins",[]),g(s,"_menubarPlugins",[]);let x=s;return typeof window<"u"&&(window.PockitOS=x,window.PockitApp=h,window.Modal=y),x});
//# sourceMappingURL=index.umd.js.map
