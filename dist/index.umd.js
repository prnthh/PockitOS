(function(a,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(a=typeof globalThis<"u"?globalThis:a||self,a.PockitOS=c())})(this,function(){"use strict";var N=Object.defineProperty;var T=(a,c,m)=>c in a?N(a,c,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[c]=m;var w=(a,c,m)=>T(a,typeof c!="symbol"?c+"":c,m);class a{constructor(e=document.body){this.container=e,this.menubar=document.createElement("div"),this.menubar.className="pockit-menubar flex items-center bg-gray-900 text-white px-2 py-1",this.menubar.style.position="fixed",this.menubar.style.top="0",this.menubar.style.left="0",this.menubar.style.right="0",this.menubar.style.width="100%",this.menubar.style.zIndex=1e5,this.menubar.style.height="32px",this.menubar.style.userSelect="none",this.container.appendChild(this.menubar),this.menus=[]}addMenu(e,t){const n=document.createElement("div");n.className="relative group mr-4",n.style.display="inline-block";const o=document.createElement("button");o.className="px-3 py-1 hover:bg-gray-700 rounded",o.textContent=e,n.appendChild(o);const i=document.createElement("div");i.className="absolute left-0 mt-1 bg-white text-black border border-gray-300 shadow-lg rounded hidden group-hover:block",i.style.minWidth="160px",i.style.zIndex=100001,t.forEach(p=>{const r=document.createElement("div");r.className="px-4 py-2 hover:bg-gray-200 cursor-pointer",r.textContent=p.label,r.onclick=d=>{d.stopPropagation(),i.style.display="none",p.onClick()},i.appendChild(r)}),o.onclick=p=>{p.stopPropagation(),document.querySelectorAll(".pockit-menubar .dropdown-open").forEach(r=>{r.classList.remove("dropdown-open"),r.style.display="none"}),i.style.display=i.style.display==="block"?"none":"block",i.style.display==="block"&&i.classList.add("dropdown-open")},document.addEventListener("click",()=>{i.style.display="none",i.classList.remove("dropdown-open")}),n.appendChild(i),this.menubar.appendChild(n),this.menus.push({label:e,options:t})}}class c{constructor(e,t=null){this.container=e,this.state=t,this.id=t&&t.id?t.id:"pockit-"+Math.random().toString(36).slice(2,10),this.setup()}setup(){this.element=this.createUI(this.state),this.container.appendChild(this.element),this.state?this.setPosition(this.state):this.centerInContainer(),this.makeDraggable(),this.element.id=this.id,this.q("textarea").addEventListener("input",()=>{var e;return(e=this.onContentChange)==null?void 0:e.call(this)})}createUI(e=null){const t=document.createElement("div");t.className="pockit-os-window fixed bg-white min-w-[300px] min-h-[150px]",t.style.cssText="z-index:1000;position:absolute;border:none;";const n=this.id;t.innerHTML=`
      <div class="title-bar flex items-center justify-between px-3 py-2 bg-gray-800 cursor-move select-none" style="border-radius:0;padding:0;opacity:1;">
        <span class='text-xs text-gray-300 ml-2 pockit-id-span'>[${n}]</span>
        <div class="buttons flex">
          <button class="btn-add w-6 h-6 flex items-center justify-center bg-green-500 hover:bg-green-600 transition" style="border-radius:0;">+</button>
          <button class="btn-eye w-6 h-6 flex items-center justify-center bg-blue-500 hover:bg-blue-600 transition" style="border-radius:0;">üëÅÔ∏è</button>
          <button class="btn-close w-6 h-6 flex items-center justify-center bg-red-500 hover:bg-red-600 transition" style="border-radius:0;">üóëÔ∏è</button>
        </div>
      </div>
      <div class="content text-gray-800" style="padding:0;">
        <textarea class="w-full h-32 border border-gray-300 mb-0" placeholder="Type here...">${(e==null?void 0:e.value)||""}</textarea>
        <div class="rendered-content w-full min-h-32 p-[1px]" style="display:none;white-space:pre-wrap;"></div>
      </div>
    `,this.attachIdEditHandler(t.querySelector(".pockit-id-span")),t.querySelector(".btn-close").onclick=()=>{var i;t.remove(),(i=this.onClose)==null||i.call(this)},t.querySelector(".btn-add").onclick=()=>{var i;return(i=this.onAdd)==null?void 0:i.call(this)};let o=!1;return t.querySelector(".btn-eye").onclick=()=>{this.setViewMode(!o),o=!o},t.querySelector("textarea").addEventListener("input",()=>{o&&this.setViewMode(!0)}),t}attachIdEditHandler(e){e.ondblclick=()=>{const t=document.createElement("input");t.type="text",t.value=this.id,t.className="text-xs text-gray-800 ml-2 pockit-id-input",t.style.cssText=`width:${Math.max(60,this.id.length*8)}px;color:#fff;background:transparent;`,e.replaceWith(t),t.focus(),t.select();const n=()=>{this.setId(t.value.trim());const o=document.createElement("span");o.className="text-xs text-gray-300 ml-2 pockit-id-span",o.textContent=`[${this.id}]`,this.attachIdEditHandler(o),t.replaceWith(o)};t.addEventListener("blur",n),t.addEventListener("keydown",o=>o.key==="Enter"&&t.blur())}}centerInContainer(){Object.assign(this.element.style,{left:"50%",top:"50%",transform:"translate(-50%, -50%)"})}setPosition(e){Object.assign(this.element.style,{left:e.left||"50%",top:e.top||"50%",transform:""}),e.zIndex&&(this.element.style.zIndex=e.zIndex)}makeDraggable(){const e=this.element,t=e.querySelector(".title-bar");let n=0,o=0,i=!1;t.addEventListener("mousedown",p=>{var h;i=!0;const r=e.getBoundingClientRect(),d=this.container.getBoundingClientRect();e.style.left=`${r.left-d.left}px`,e.style.top=`${r.top-d.top}px`,e.style.transform="",n=p.clientX-(r.left-d.left),o=p.clientY-(r.top-d.top),(h=this.onFocus)==null||h.call(this);const u=x=>{var v;if(!i)return;const g=this.container.getBoundingClientRect();e.style.left=`${x.clientX-g.left-n}px`,e.style.top=`${x.clientY-g.top-o}px`,(v=this.onMove)==null||v.call(this)},l=()=>{i=!1,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",l)})}q(e){return this.element.querySelector(e)}getContent(){var e;return((e=this.q("textarea"))==null?void 0:e.value)||""}setContent(e){this.q("textarea")&&(this.q("textarea").value=e)}getState(){return{left:this.element.style.left,top:this.element.style.top,zIndex:this.element.style.zIndex,value:this.getContent(),id:this.id}}setZIndex(e){this.element.style.zIndex=e}setId(e){var n;if(!e)return;this.id=e,this.element.id=this.id;const t=this.q(".pockit-id-span");t&&(t.textContent=`[${this.id}]`),(n=this.onContentChange)==null||n.call(this)}setViewMode(e){var p,r;const t=this.q(".btn-eye"),n=this.q("textarea"),o=this.q(".rendered-content"),i=this.q(".title-bar");if(t)if(e){(p=this._injectedModuleScripts)==null||p.forEach(l=>l.remove()),this._injectedModuleScripts=[],o.innerHTML="";const d=document.createElement("div");d.innerHTML=n.value,d.querySelectorAll('script[type="module"]').forEach(l=>{const h=document.createElement("script");h.type="module",h.textContent=l.textContent,document.body.appendChild(h),(this._injectedModuleScripts||(this._injectedModuleScripts=[])).push(h),l.remove()});const u=d.querySelector('script[type="importmap"]');if(u&&!document.querySelector('script[type="importmap"][data-pockit]')){const l=document.createElement("script");l.type="importmap",l.setAttribute("data-pockit","true"),l.textContent=u.textContent,document.head.appendChild(l),u.remove()}for(;d.firstChild;)o.appendChild(d.firstChild);n.style.display="none",o.style.display="",t.textContent="‚úèÔ∏è",this.element.style.border="none",i&&(i.style.opacity="0.5")}else(r=this._injectedModuleScripts)==null||r.forEach(d=>d.remove()),this._injectedModuleScripts=[],n.style.display="",o.style.display="none",t.textContent="üëÅÔ∏è",this.element.style.border="none",i&&(i.style.opacity="1")}}class m{constructor({content:e="",onClose:t=null}={}){this.content=e,this.onClose=typeof t=="function"?t:null,this.element=this.createModal(),document.body.appendChild(this.element)}createModal(){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background="rgba(0,0,0,0.3)",e.style.zIndex=1e6,e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center";const t=document.createElement("div");t.className="pockit-modal bg-white rounded shadow-lg p-6 max-w-md w-full relative",t.style.position="relative",t.style.boxShadow="0 4px 32px rgba(0,0,0,0.18)";const n=document.createElement("button");n.textContent="√ó",n.setAttribute("aria-label","Close"),n.style.position="absolute",n.style.top="12px",n.style.right="16px",n.style.fontSize="1.5rem",n.style.background="none",n.style.border="none",n.style.cursor="pointer",n.onclick=()=>this.close();const o=document.createElement("div");return typeof this.content=="string"?o.innerHTML=this.content:this.content instanceof Node&&o.appendChild(this.content),t.appendChild(n),t.appendChild(o),e.appendChild(t),e.onclick=i=>{i.target===e&&this.close()},e}close(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.onClose&&this.onClose()}}function A(){return`
    <div style="font-size:12px;font-weight:bold;margin-bottom:4px;">PockitOS Memory</div>
    <textarea id="pockit-debug-textarea" style="width:320px;height:180px;font-size:11px;font-family:monospace;" class="mb-0"></textarea>
    <div style="margin-top:4px;">
      <button id="pockit-restoreall-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#f3f3f3;cursor:pointer;">Load</button>
    </div>
  `}class q{constructor(e){this.PockitOS=e}show(){const e=new m({content:A(),onClose:()=>{}});setTimeout(()=>{document.getElementById("pockit-debug-textarea").value=this.PockitOS.memory.map(t=>`<div style="left:${t.left};top:${t.top};z-index:${t.zIndex};position:absolute;" id="${t.id||""}">${t.value}</div>`).join(`

`),document.getElementById("pockit-restoreall-btn").onclick=()=>{this.PockitOS.restoreAll(),e.close()}},0)}}function z(){const f="pockit-tailwind-cdn";if(!document.getElementById(f)){const e=document.createElement("script");e.id=f,e.src="https://cdn.tailwindcss.com",document.head.appendChild(e)}}const s=class s{static setKioskMode(e){s.kioskMode=e;const t=document.querySelector(".pockit-menubar");t&&(t.style.display=e?"none":"");const n=document.getElementById("pockit-debug-window");n&&(n.style.display=e?"none":""),document.querySelectorAll(".pockit-os-window .title-bar").forEach(o=>{o.style.display=e?"none":""}),window.PockitOS&&window.PockitOS._instances&&window.PockitOS._instances.forEach(o=>{o.apps&&o.apps.forEach(i=>{e&&(i.setViewMode(!1),i.setViewMode(!0))})})}constructor(e=document.body,t=null,n=null){if(this.container=e,this.apps=[],this.onStateChange=typeof t=="function"?t:null,z(),typeof window<"u"&&(window.PockitOS._instances||(window.PockitOS._instances=[]),window.PockitOS._instances.push(this)),this.saveMenu=new q(s),typeof n=="string"&&n.trim().startsWith("<div")){s.restoreAll(e,n);return}Array.isArray(n)&&n.length>0?(s.memory=n,n.forEach(i=>this.createApp(i))):n?this.createApp(n):this.createApp(),document.querySelector(".pockit-menubar")||new a(document.body).addMenu("OS",[{label:"New Window",onClick:()=>{this.createApp()}},{label:"Save/Load",onClick:()=>{this.saveMenu.show()}},{label:"Kiosk Mode",onClick:()=>{s.setKioskMode(!s.kioskMode)}},{label:"About",onClick:()=>{new m({content:"<div class='text-center'><h2 class='text-lg font-bold mb-2'>About PockitOS</h2><p class='mb-2'>PockitOS is a lightweight, modular web OS for running and managing Pockit apps in your browser.</p><p class='text-xs text-gray-500'>¬© 2025 prnth</p></div>"})}}]);const o=document.getElementById("pockit-debug-window");o&&o.remove(),s.kioskMode&&s.setKioskMode(!0)}createApp(e=null){const t=new c(this.container,e);return t.onClose=()=>{const n=this.apps.indexOf(t);n!==-1&&this.apps.splice(n,1),s.updateMemory(this.onStateChange)},t.onAdd=()=>{this.createApp()},t.onContentChange=()=>{s.updateMemory(this.onStateChange)},t.onFocus=()=>{t.setZIndex(s.zIndexCounter++),s.updateMemory(this.onStateChange)},t.onMove=()=>{s.updateMemory(this.onStateChange)},t.setZIndex(s.zIndexCounter++),this.apps.push(t),t}static updateMemory(e=null){const t=[];document.querySelectorAll(".pockit-os-window").forEach(o=>{const i=o.querySelector("textarea");t.push({left:o.style.left,top:o.style.top,zIndex:o.style.zIndex,value:i?i.value:"",id:o.id})}),s.memory=t;const n=s.memory.map(o=>`<div style="left:${o.left};top:${o.top};z-index:${o.zIndex};position:absolute;" id="${o.id}">${o.value}</div>`).join(`

`);typeof e=="function"&&e(n)}static restoreAll(e=document.body,t=null){document.querySelectorAll(".pockit-os-window").forEach(i=>i.remove());let n=t;if(!n){const i=document.getElementById("pockit-debug-textarea");i&&(n=i.value.trim())}if(n&&n.startsWith("<div")){const i=[];new DOMParser().parseFromString(`<root>${n}</root>`,"text/html").body.querySelectorAll("root > div").forEach(u=>{var k,C,E,S,M,I;const l=u.getAttribute("style")||"",h=((C=(k=/left:([^;]+);/.exec(l))==null?void 0:k[1])==null?void 0:C.trim())||"",x=((S=(E=/top:([^;]+);/.exec(l))==null?void 0:E[1])==null?void 0:S.trim())||"",g=((I=(M=/z-index:([^;]+);/.exec(l))==null?void 0:M[1])==null?void 0:I.trim())||"",v=u.getAttribute("id")||"";let L=Array.from(u.childNodes).map(y=>y.nodeType===Node.ELEMENT_NODE&&y.nodeName==="DIV"?y.outerHTML:y.nodeType===Node.TEXT_NODE?y.textContent:y.nodeType===Node.ELEMENT_NODE?y.outerHTML:"").join("");i.push({left:h,top:x,zIndex:g,value:L,id:v})}),i.length>0&&(s.memory=i)}const o=new s(e);o.apps.length>0&&(o.apps[0].element.remove(),o.apps=[]),s.memory.forEach(i=>o.createApp(i)),showDebugWindow(),updateDebugWindow()}};w(s,"zIndexCounter",1e3),w(s,"memory",[]),w(s,"kioskMode",!1);let b=s;return typeof window<"u"&&(window.PockitOS=b),b});
//# sourceMappingURL=index.umd.js.map
