(function(u,m){typeof exports=="object"&&typeof module<"u"?module.exports=m():typeof define=="function"&&define.amd?define(m):(u=typeof globalThis<"u"?globalThis:u||self,u.PockitOS=m())})(this,function(){"use strict";var P=Object.defineProperty;var T=(u,m,w)=>m in u?P(u,m,{enumerable:!0,configurable:!0,writable:!0,value:w}):u[m]=w;var g=(u,m,w)=>T(u,typeof m!="symbol"?m+"":m,w);class u{constructor(t=document.body){this.container=t,this.menubar=document.createElement("div"),this.menubar.className="pockit-menubar flex items-center bg-gray-900 text-white px-2 py-1",this.menubar.style.position="fixed",this.menubar.style.top="0",this.menubar.style.left="0",this.menubar.style.right="0",this.menubar.style.width="100%",this.menubar.style.zIndex=1e5,this.menubar.style.height="32px",this.menubar.style.userSelect="none",this.container.appendChild(this.menubar),this.menus=[],u.instances||(u.instances=[]),u.instances.push(this)}addMenu(t,e){const n=document.createElement("div");n.className="relative group mr-4",n.style.display="inline-block";const i=document.createElement("button");i.className="px-3 py-1 hover:bg-gray-700 rounded",i.textContent=t,n.appendChild(i);const s=document.createElement("div");s.className="absolute left-0 mt-1 bg-white text-black border border-gray-300 shadow-lg rounded hidden",s.style.minWidth="160px",s.style.zIndex=100001,e.forEach(o=>{const d=document.createElement("div");d.className="px-4 py-2 hover:bg-gray-200 cursor-pointer",d.textContent=o.label,d.onclick=c=>{c.stopPropagation(),s.style.display="none",o.onClick()},s.appendChild(d)}),i.onclick=o=>{o.stopPropagation(),document.querySelectorAll(".pockit-menubar .dropdown-open").forEach(d=>{d.classList.remove("dropdown-open"),d.style.display="none"}),s.style.display=s.style.display==="block"?"none":"block",s.style.display==="block"&&s.classList.add("dropdown-open")},document.addEventListener("click",()=>{s.style.display="none",s.classList.remove("dropdown-open")}),n.appendChild(s),this.menubar.appendChild(n),this.menus.push({label:t,options:e})}}typeof window<"u"&&(window.PockitMenubar=u);class m{constructor(t,e=null){this.container=t,this.state=e,this.id=e&&e.id?e.id:"pockit-"+Math.random().toString(36).slice(2,10),this.setup()}setup(){this.element=this.createUI(this.state),this.container.appendChild(this.element),this.state?this.setPosition(this.state):this.centerInContainer(),this.makeDraggable(),this.element.id=this.id,this.element.classList.add("bg-white/60","backdrop-blur"),this.q("textarea").addEventListener("input",()=>{var t;return(t=this.onContentChange)==null?void 0:t.call(this)}),window.PockitOS&&Array.isArray(window.PockitOS._plugins)&&this.addPluginButtons(),this.isRendered=!1,this.setViewMode(!1)}addPluginButtons(){if(!window.PockitOS||!Array.isArray(window.PockitOS._plugins))return;const t=this.element.querySelector(".buttons");t&&window.PockitOS._plugins.forEach((e,n)=>{if(t.querySelector(`.btn-plugin[data-plugin-idx="${n}"]`))return;const i=document.createElement("button");i.className="btn-plugin w-6 h-6 flex items-center justify-center bg-yellow-400 hover:bg-yellow-500 transition mr-1",i.style.borderRadius="0",i.setAttribute("data-plugin-idx",n),i.innerHTML=e.icon||"★",i.onclick=()=>e.handler(this),t.insertBefore(i,t.firstChild)})}createUI(t=null){const e=document.createElement("div");e.className="pockit-os-window fixed min-w-[300px] min-h-[150px]",e.style.cssText="z-index:1000;position:absolute;border:none;";const n=this.id;let i="";if(window.PockitOS&&window.PockitOS._plugin&&(i='<button class="btn-plugin w-6 h-6 flex items-center justify-center bg-yellow-400 hover:bg-yellow-500 transition mr-1" style="border-radius:0;">★</button>'),e.innerHTML=`
      <div class="title-bar flex items-center justify-between px-3 py-2 bg-gray-800 cursor-move select-none" style="border-radius:0;padding:0;opacity:1;">
        <span class='text-xs text-gray-300 ml-2 pockit-id-span'>[${n}]</span>
        <div class="buttons flex">
          ${i}
          <button class="btn-eye w-6 h-6 flex items-center justify-center bg-green-500 hover:bg-blue-600 transition" style="border-radius:0;">✏️</button>
          <button class="btn-sendback w-6 h-6 flex items-center justify-center bg-gray-500 hover:bg-gray-600 transition" style="border-radius:0;">⏬</button>
          <button class="btn-add w-6 h-6 flex items-center justify-center bg-blue-500 hover:bg-green-600 transition" style="border-radius:0;">👯‍♀️</button>
          <button class="btn-close w-6 h-6 flex items-center justify-center bg-red-500 hover:bg-red-600 transition" style="border-radius:0;">🗑️</button>
        </div>
      </div>
      <div class="content text-gray-800" style="padding:0;">
        <textarea class="w-full h-32 border border-gray-300 mb-0" style="resize: both;" placeholder="Type here...">${(t==null?void 0:t.value)||""}</textarea>
        <div class="rendered-content w-full min-h-32 p-[1px]" style="display:none;white-space:pre-wrap;"></div>
      </div>
    `,this.attachIdEditHandler(e.querySelector(".pockit-id-span")),e.querySelector(".btn-close").onclick=()=>{var s;e.remove(),(s=this.onClose)==null||s.call(this)},e.querySelector(".btn-add").onclick=()=>{var a,p;const s=this.getState(),o=(parseInt(s.left,10)||0)+30,d=(parseInt(s.top,10)||0)-30,c={...s,left:o+"px",top:d+"px",id:void 0};(a=this.onDuplicate)==null||a.call(this,c),(p=this.onStateChange)==null||p.call(this,c)},e.querySelector(".btn-eye").onclick=()=>{this.setViewMode(!this.isRendered)},e.querySelector(".btn-sendback").onclick=()=>{var s;this.setZIndex(1),(s=this.updateMemory)==null||s.call(this)},e.querySelector("textarea").addEventListener("input",()=>{this.isRendered&&this.setViewMode(!0)}),window.PockitOS&&window.PockitOS._plugin){const s=e.querySelector(".btn-plugin");s&&(s.onclick=()=>window.PockitOS._plugin(this))}return e}attachIdEditHandler(t){t.ondblclick=()=>{const e=document.createElement("input");e.type="text",e.value=this.id,e.className="text-xs text-gray-800 ml-2 pockit-id-input",e.style.cssText=`width:${Math.max(60,this.id.length*8)}px;color:#fff;background:transparent;`,t.replaceWith(e),e.focus(),e.select();const n=()=>{this.setId(e.value.trim());const i=document.createElement("span");i.className="text-xs text-gray-300 ml-2 pockit-id-span",i.textContent=`[${this.id}]`,this.attachIdEditHandler(i),e.replaceWith(i)};e.addEventListener("blur",n),e.addEventListener("keydown",i=>i.key==="Enter"&&e.blur())}}centerInContainer(){Object.assign(this.element.style,{left:"50%",top:"50%",transform:"translate(-50%, -50%)"})}setPosition(t){Object.assign(this.element.style,{left:t.left||"50%",top:t.top||"50%",transform:""}),t.zIndex&&(this.element.style.zIndex=t.zIndex)}makeDraggable(){const t=this.element;t.querySelector(".title-bar");let e=0,n=0,i=!1;const s=20;let o=!1;const d=l=>Math.round(l/s)*s;this._dragHandlers=this._dragHandlers||{};const c=(l,f,b=!1)=>{var h;if(t.style.transform&&t.style.transform.includes("translate")){const y=t.offsetParent.getBoundingClientRect(),x=t.getBoundingClientRect();t.style.left=x.left-y.left+"px",t.style.top=x.top-y.top+"px",t.style.transform=""}e=l-t.offsetLeft,n=f-t.offsetTop,i=!0,o=b,(h=this.onFocus)==null||h.call(this)},a=(l,f,b=!1)=>{var x;if(!i)return;let h=l-e,y=f-n;(b||o)&&(h=d(h),y=d(y)),t.style.left=h+"px",t.style.top=y+"px",(x=this.onMove)==null||x.call(this)},p=()=>{i=!1};this._dragHandlers.mouseDown=l=>{if(!this._draggableEnabled)return;c(l.pageX,l.pageY,l.shiftKey);const f=h=>a(h.pageX,h.pageY,h.shiftKey),b=()=>{p(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",b)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",b)},this._dragHandlers.touchStart=l=>{if(!this._draggableEnabled||l.touches.length!==1)return;const f=l.touches[0];c(f.pageX,f.pageY,o);const b=y=>{y.touches.length===1&&a(y.touches[0].pageX,y.touches[0].pageY,o)},h=()=>{p(),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",h)};document.addEventListener("touchmove",b),document.addEventListener("touchend",h)},this._dragHandlers.keyDown=l=>{l.key==="Shift"&&(o=!0)},this._dragHandlers.keyUp=l=>{l.key==="Shift"&&(o=!1)},this.enableDraggable(!0)}enableDraggable(t){const e=this.element,n=e.querySelector(".title-bar");this._draggableEnabled=t,this._dragHandlers&&(t?(n.addEventListener("mousedown",this._dragHandlers.mouseDown),n.addEventListener("touchstart",this._dragHandlers.touchStart),window.addEventListener("keydown",this._dragHandlers.keyDown),window.addEventListener("keyup",this._dragHandlers.keyUp)):(n.removeEventListener("mousedown",this._dragHandlers.mouseDown),n.removeEventListener("touchstart",this._dragHandlers.touchStart),window.removeEventListener("keydown",this._dragHandlers.keyDown),window.removeEventListener("keyup",this._dragHandlers.keyUp)))}q(t){return this.element.querySelector(t)}getContent(){var t;return((t=this.q("textarea"))==null?void 0:t.value)||""}setContent(t){this.q("textarea")&&(this.q("textarea").value=t)}getState(){return{left:this.element.style.left,top:this.element.style.top,zIndex:this.element.style.zIndex,value:this.getContent(),id:this.id}}setZIndex(t){this.element.style.zIndex=t}updateMemory(){if(window.PockitOS&&Array.isArray(window.PockitOS._instances)&&window.PockitOS._instances.length>0){const t=window.PockitOS._instances[0];typeof t.updateMemory=="function"&&t.updateMemory()}}setId(t){var n;if(!t)return;this.id=t,this.element.id=this.id;const e=this.q(".pockit-id-span");e&&(e.textContent=`[${this.id}]`),(n=this.onContentChange)==null||n.call(this),this.updateMemory()}setViewMode(t){var c;const e=this.q(".btn-eye"),n=this.q("textarea"),i=this.q(".rendered-content"),s=this.q(".title-bar");if(!e)return;const o=this.element;(c=this._injectedModuleScripts)==null||c.forEach(a=>a.remove()),this._injectedModuleScripts=[];const d=this.element.querySelectorAll(".btn-sendback, .btn-add, .btn-close, .btn-plugin");if(t){d.forEach(p=>p.style.display="none"),i.innerHTML="";const a=document.createElement("div");for(a.innerHTML=n.value,a.querySelectorAll("script").forEach(p=>{const l=document.createElement("script");for(const f of p.attributes)l.setAttribute(f.name,f.value);l.textContent=p.textContent,p.type==="importmap"?document.querySelector('script[type="importmap"][data-pockit]')||(l.setAttribute("data-pockit","true"),document.head.appendChild(l),(this._injectedModuleScripts||(this._injectedModuleScripts=[])).push(l)):(document.body.appendChild(l),(this._injectedModuleScripts||(this._injectedModuleScripts=[])).push(l)),p.remove()});a.firstChild;)i.appendChild(a.firstChild);n.style.display="none",i.style.display="",s&&(s.style.opacity="0.5",s.classList.add("opacity-50")),o.classList.remove("bg-white/60","backdrop-blur"),o.classList.remove("opacity-50"),e.innerHTML="✏️",this.enableDraggable(!1)}else d.forEach(a=>a.style.display=""),n.style.display="",i.style.display="none",s&&(s.style.opacity="1",s.classList.remove("opacity-50")),o.classList.remove("opacity-50"),o.classList.add("bg-white/60","backdrop-blur"),e.innerHTML="▶️",this.enableDraggable(!0);this.element.style.border="none",this.isRendered=t}}class w{constructor({content:t="",onClose:e=null}={}){this.content=null,this.onClose=typeof e=="function"?e:null,this.element=this.createModal(t),document.body.appendChild(this.element)}createModal(t){const e=document.createElement("div");e.className="fixed inset-0 w-screen h-screen bg-black/30 z-[1000000] flex items-center justify-center";const n=document.createElement("div");n.className="pockit-modal bg-white border border-black min-w-0 md:min-w-[600px] max-w-[95vw] relative flex p-6 shadow-[0_4px_32px_rgba(0,0,0,0.18)]";const i=document.createElement("button");i.textContent="×",i.setAttribute("aria-label","Close"),i.className="absolute top-0 right-[10px] text-[1.5rem] bg-none border-none cursor-pointer",i.onclick=()=>this.close();const s=document.createElement("div");return s.className="w-full flex flex-col",typeof t=="string"?s.innerHTML=t:t instanceof Node&&s.appendChild(t),this.content=s,n.appendChild(i),n.appendChild(s),e.appendChild(n),e.onclick=o=>{o.target===e&&this.close()},e}close(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.onClose&&this.onClose()}}function I(){return`
    <div style="font-size:12px;font-weight:bold;margin-bottom:4px;">PockitOS Memory</div>
    <textarea id="pockit-debug-textarea" style="width:100%;height:180px;font-size:11px;font-family:monospace;" class="mb-0"></textarea>
    <div style="margin-top:4px;">
      <button id="pockit-restoreall-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#f3f3f3;cursor:pointer;">Load</button>
      <button id="pockit-save-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#e3f3e3;cursor:pointer;margin-left:8px;">Save</button>
      <button id="pockit-viewraw-btn" style="font-size:11px;padding:2px 8px;border:1px solid #bbb;background:#e3e3f3;cursor:pointer;margin-left:8px;">View Raw</button>
    </div>
  `}class D{constructor(t){this.PockitOS=t}show(){const t=new w({content:I(),onClose:()=>{}});setTimeout(()=>{const e=document.getElementById("pockit-debug-textarea");e.style.display="none",e.value=this.PockitOS.memory.map(o=>`<div style="left:${o.left};top:${o.top};z-index:${o.zIndex};position:absolute;white-space:pre-wrap;" id="${o.id||""}">${o.value}</div>`).join(`

`);let n=document.getElementById("pockit-load-file-input");n||(n=document.createElement("input"),n.type="file",n.accept=".html,text/html",n.style.display="none",n.id="pockit-load-file-input",document.body.appendChild(n)),document.getElementById("pockit-restoreall-btn").onclick=()=>{n.value="",n.click()},n.onchange=o=>{const d=o.target.files[0];if(!d)return;const c=new FileReader;c.onload=a=>{const p=a.target.result,l=/<body[^>]*>([\s\S]*?)<\/body>/i.exec(p);l&&l[1]&&(e.value=l[1].trim(),e.dispatchEvent(new Event("input",{bubbles:!0})),t.close())},c.readAsText(d)},document.getElementById("pockit-save-btn").onclick=()=>{const d=`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PockitOS Memory Dump</title>
  <style>body{background:#fafafa;margin:24px;}div{margin-bottom:8px;}</style>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"><\/script>
</head>
<body>
${e.value}
</body>
</html>`,c=new Blob([d],{type:"text/html"}),a=document.createElement("a");a.href=URL.createObjectURL(c),a.download="pockitos-memory.html",document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(a.href)},100)};const i=document.getElementById("pockit-viewraw-btn");let s=!1;i.textContent="View Raw",i.onclick=()=>{s=!s,e.style.display=s?"":"none",i.textContent=s?"Hide Raw":"View Raw"},e.addEventListener("input",()=>{this.PockitOS.restoreAll(void 0,e.value),this.PockitOS.onStateChange&&this.PockitOS.updateMemory()})},0)}}function A(){const k="pockit-tailwind-cdn";if(!document.getElementById(k)){const t=document.createElement("script");t.id=k,t.src="https://cdn.tailwindcss.com",document.head.appendChild(t)}}const r=class r{static loadMenubarPlugin(t){r._menubarPlugins||(r._menubarPlugins=[]),r._menubarPlugins.push(t),r._instances&&r._instances.length&&r._instances.forEach(e=>{var i,s;if(document.querySelector(".pockit-menubar")&&e){const o=(typeof window<"u"?(s=(i=window.PockitMenubar)==null?void 0:i.instances)==null?void 0:s[0]:null)||null;if(o)try{t(o,e)}catch{}}})}static setKioskMode(t){r.kioskMode=t;const e=document.querySelector(".pockit-menubar");e&&(e.style.display=t?"none":"");const n=document.getElementById("pockit-debug-window");n&&(n.style.display=t?"none":""),document.querySelectorAll(".pockit-os-window .title-bar").forEach(i=>{i.style.display=t?"none":""}),r._instances&&r._instances.length&&r._instances.forEach(i=>{i.apps&&i.apps.forEach(s=>{t&&(s.setViewMode(!1),s.setViewMode(!0))})})}constructor(t=document.body,e={},n={}){this.container=t,this.apps=[],this.onStateChange=typeof e.onStateChange=="function"?e.onStateChange:null,this.onStateChange&&(r.onStateChange=this.onStateChange),A(),this._setupDragAndDrop(),r._instances||(r._instances=[]),r._instances.push(this),this.saveMenu=new D(this);let i=!1;if(typeof e.state=="string"&&e.state.trim().startsWith("<div")?(i=!0,this._restoringFromDOM=!0,this.restoreAll(t,e.state)):Array.isArray(e.state)&&e.state.length>0?(r.memory=e.state,e.state.forEach(o=>this.createApp(o))):e.state?this.createApp(e.state):i||this.createApp(),!document.querySelector(".pockit-menubar")){const o=new u(document.body),d=[{label:"New Window",onClick:()=>{this.createApp()}},{label:"Save/Load",onClick:()=>{this.saveMenu.show()}},{label:"Kiosk Mode",onClick:()=>{r.setKioskMode(!r.kioskMode)}},{label:"About",onClick:()=>{new w({content:`<div class='text-center'><h2 class='text-lg font-bold mb-2'>About PockitOS</h2><p class='mb-2'><a target="_blank" href="https://github.com/prnthh/PockitOS">PockitOS</a> is a lightweight, modular web OS for running and managing Pockit apps in your browser.</p><p class='text-xs text-gray-500'>© 2025 prnth</p></div>`})}}];n&&typeof n=="object"&&Object.entries(n).forEach(([c,a])=>{typeof a=="function"&&d.push({label:c,onClick:a})}),o.addMenu("OS",d),r._menubarPlugins&&Array.isArray(r._menubarPlugins)&&r._menubarPlugins.forEach(c=>{try{c(o,this)}catch{}})}const s=document.getElementById("pockit-debug-window");s&&s.remove(),r.kioskMode&&r.setKioskMode(!0)}createApp(t=null){const e=new m(this.container,t);return e.onClose=()=>{const n=this.apps.indexOf(e);n!==-1&&this.apps.splice(n,1),this.updateMemory()},e.onAdd=()=>{this.createApp()},e.onContentChange=()=>{this.updateMemory()},e.onFocus=()=>{e.setZIndex(r.zIndexCounter++),this.updateMemory()},e.onMove=()=>{this.updateMemory()},e.onDuplicate=n=>{this.createApp(n),this.updateMemory()},e.setZIndex(r.zIndexCounter++),this.apps.push(e),e}updateMemory(){const t=[];document.querySelectorAll(".pockit-os-window").forEach(n=>{const i=n.querySelector("textarea");t.push({left:n.style.left,top:n.style.top,zIndex:n.style.zIndex,value:i?i.value:"",id:n.id})}),t.sort((n,i)=>{const s=parseInt(n.left,10)||0,o=parseInt(i.left,10)||0;if(s!==o)return s-o;const d=parseInt(n.top,10)||0,c=parseInt(i.top,10)||0;return d-c}),this.memory=t;const e=this.memory.map(n=>`<div style="left:${n.left};top:${n.top};z-index:${n.zIndex};position:absolute;" id="${n.id}">${n.value}</div>`).join(`

`);typeof this.onStateChange=="function"&&this.onStateChange(e)}restoreAll(t=this.container,e=null){document.querySelectorAll(".pockit-os-window").forEach(i=>i.remove());let n=e;if(!n){const i=document.getElementById("pockit-debug-textarea");i&&(n=i.value.trim())}if(n&&n.startsWith("<div")){const i=[];new DOMParser().parseFromString(`<root>${n}</root>`,"text/html").body.querySelectorAll("root > div").forEach(c=>{var y,x,S,C,M,L;const a=c.getAttribute("style")||"",p=((x=(y=/left:([^;]+);/.exec(a))==null?void 0:y[1])==null?void 0:x.trim())||"",l=((C=(S=/top:([^;]+);/.exec(a))==null?void 0:S[1])==null?void 0:C.trim())||"",f=((L=(M=/z-index:([^;]+);/.exec(a))==null?void 0:M[1])==null?void 0:L.trim())||"",b=c.getAttribute("id")||"";let h=Array.from(c.childNodes).map(v=>v.nodeType===Node.ELEMENT_NODE&&v.nodeName==="DIV"?v.outerHTML:v.nodeType===Node.TEXT_NODE?v.textContent:v.nodeType===Node.ELEMENT_NODE?v.outerHTML:"").join("");i.push({left:p,top:l,zIndex:f,value:h,id:b})}),i.length>0&&(this.memory=i)}this.apps.length>0&&(this.apps[0].element.remove(),this.apps=[]),this.memory.forEach(i=>{const s=this.createApp(i);typeof s.setViewMode=="function"&&s.setViewMode(!0)}),typeof showDebugWindow=="function"&&showDebugWindow(),typeof updateDebugWindow=="function"&&updateDebugWindow(),this.updateMemory()}static loadPlugin(t,e="★"){r._plugins||(r._plugins=[]),r._plugins.push({handler:t,icon:e}),r._instances&&r._instances.length&&r._instances.forEach(n=>{n.apps&&n.apps.forEach(i=>i.addPluginButtons())})}static registerMenubarPlugin(t){r._menubarPlugins||(r._menubarPlugins=[]),r._menubarPlugins.push(t)}_setupDragAndDrop(){document.documentElement.style.minHeight="100vh",document.body.style.minHeight="100vh";const t=document.body;t.addEventListener("dragover",e=>{r.kioskMode||(e.preventDefault(),console.log("dragover event",e))},!0),t.addEventListener("drop",async e=>{e.preventDefault();let n="";if(e.dataTransfer.files&&e.dataTransfer.files.length>0){const i=e.dataTransfer.files[0];if(i.type.startsWith("image/")){const s=new FileReader;n=await new Promise(o=>{s.onload=d=>o(`<img src='${d.target.result}' style='max-width:100%;max-height:300px;'/>`),s.readAsDataURL(i)})}else n=i.name}else e.dataTransfer.getData("text/html")?n=e.dataTransfer.getData("text/html"):e.dataTransfer.getData("text/plain")&&(n=e.dataTransfer.getData("text/plain"));if(n){const i=e.clientX+"px",s=e.clientY+"px",o=this.createApp({left:i,top:s,value:n});typeof o.setViewMode=="function"&&o.setViewMode(!0)}},!0)}};g(r,"zIndexCounter",1e3),g(r,"memory",[]),g(r,"kioskMode",!1),g(r,"_plugin",null),g(r,"_plugins",[]),g(r,"_menubarPlugins",[]),g(r,"_instances",[]),g(r,"onStateChange",null);let E=r;return typeof window<"u"&&(window.PockitOS=E,window.PockitApp=m,window.Modal=w),E});
//# sourceMappingURL=index.umd.js.map
